# v5.1.1 - Critical Fixes & New Features

## New Features

### 1. Keep Me Signed In
Users can now choose to stay logged in across browser sessions.

**How it works:**
- Checkbox on login page: "Keep me signed in"
- Checked (default): Session persists even after closing browser
- Unchecked: Session ends when browser closes
- Stores preference in localStorage

### 2. Forgot Password
Password reset functionality for users who forget their credentials.

**How it works:**
- Click "Forgot password?" link on login page
- Enter email address
- Receive password reset email with secure link
- Reset password and sign back in

### 3. Auto-Show Version Notes
Version notes now automatically appear once after each update.

**How it works:**
- Tracks last seen version in localStorage
- Shows version notes modal 1 second after login if version changed
- Only shows once per version
- Can still be manually accessed via version button

### 4. Better Mobile Viewport
Proper viewport meta tag prevents mobile zoom issues.

**What changed:**
- Added `viewport: 'width=device-width, initial-scale=1, maximum-scale=1'`
- Prevents forced zoom-out on mobile
- Tables remain scrollable but page fits screen
- Bottom navigation stays readable

## Bug Fixes

### 1. History Page Net Worth Calculation
**Problem:** Debt was being added to assets instead of subtracted.

**Fix:**
- Now queries asset `type` from database
- Debt displays in red with minus sign
- Net Worth = Assets - Debt (correct calculation)
- Total label changed from "Total Assets" to "Net Worth"

**Before:**
```
Savings: $10,000
Credit Card: $2,000
Total Assets: $12,000  ← Wrong!
```

**After:**
```
Savings: $10,000
Credit Card: -$2,000  (in red)
Net Worth: $8,000  ← Correct!
```

### 2. Transactions Button Width
**Problem:** "Add Purchase" button was spanning full screen width on desktop.

**Fix:**
- Changed layout from stacked divs to flex row on desktop
- Button now properly aligned to the right
- Still hidden on mobile (use bottom nav)

### 3. Mobile Viewport Issues
**Problem:** Users had to zoom out to see full page on mobile.

**Fix:**
- Added proper viewport meta configuration
- `maximum-scale=1` prevents iOS auto-zoom
- Pages now fit mobile screens properly
- No need to manually zoom

## Technical Details

### Files Modified

**Authentication & Session:**
- `app/page.tsx` - Added keep signed in, forgot password UI and logic
- `app/dashboard/layout.tsx` - Added auto-show version notes on first login

**History Page:**
- `app/dashboard/history/page.tsx` - Fixed net worth calculation, added asset type

**Transactions Page:**
- `app/dashboard/transactions/page.tsx` - Fixed button layout

**App Configuration:**
- `app/layout.tsx` - Added proper viewport meta tag

**Version:**
- `lib/version_notes.ts` - Added v5.1.1 notes

### Keep Signed In Implementation

```typescript
// On login
if (keep_signed_in) {
  localStorage.setItem('keep_signed_in', 'true')
} else {
  sessionStorage.setItem('temp_session', 'true')
}
```

Supabase automatically handles session persistence based on storage.

### Version Notes Auto-Show

```typescript
useEffect(() => {
  const last_seen_version = localStorage.getItem('last_seen_version')
  if (!last_seen_version || last_seen_version !== CURRENT_VERSION) {
    setTimeout(() => {
      window.dispatchEvent(new CustomEvent('show-version-notes'))
      localStorage.setItem('last_seen_version', CURRENT_VERSION)
    }, 1000)
  }
}, [])
```

Shows modal 1 second after login, only once per version.

### Forgot Password Flow

1. User clicks "Forgot password?"
2. Enter email address
3. Supabase sends reset email with secure token
4. User clicks link (redirects to `/reset-password`)
5. User enters new password
6. Can sign in with new credentials

## Testing Checklist

### Keep Me Signed In
- [ ] Check checkbox, sign in, close browser, reopen → still signed in
- [ ] Uncheck checkbox, sign in, close browser, reopen → signed out
- [ ] Default state is checked

### Forgot Password
- [ ] Click "Forgot password?" → shows email form
- [ ] Enter email, submit → shows success message
- [ ] Check email for reset link
- [ ] Click "Back to sign in" → returns to login

### Version Notes
- [ ] First login after update → version notes show after 1 second
- [ ] Close modal, refresh page → notes don't show again
- [ ] Click version button → can manually open notes

### History Page
- [ ] Debt assets show in red with minus sign
- [ ] Net Worth = positive assets - debt
- [ ] Label says "Net Worth" not "Total Assets"

### Transactions Button
- [ ] Desktop: Button aligned right, not full width
- [ ] Mobile: Button hidden (use + in bottom nav)

### Mobile Viewport
- [ ] Open on mobile → fits screen, no forced zoom
- [ ] Bottom nav is readable size
- [ ] Tables scroll horizontally if needed

## User Benefits

1. **Convenience**: Stay signed in across sessions
2. **Security**: Easy password recovery if forgotten
3. **UX**: Version notes only shown when relevant
4. **Accuracy**: Correct net worth calculations with debt
5. **Mobile**: Proper mobile experience without zoom issues

## Breaking Changes

None - all changes are additive or fixes.

## Migration Notes

No database migration needed. Frontend-only changes.

## Future Enhancements

Potential improvements for next version:
- Remember me duration setting (7 days, 30 days, etc.)
- Email verification resend option
- Change password from settings
- Session activity log
- Biometric login for mobile

Deploy and enjoy the improvements!
